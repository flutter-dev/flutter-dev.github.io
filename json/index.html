<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>JSON 和序列化  - Flutter </title>
  <link rel="shortcut icon" href="/images/favicon.png">

  <meta name="description" content="">
  <meta name="keywords" content=" ">

  <link rel="stylesheet" href="/css/lavish-bootstrap.css">
  <link rel="stylesheet" href="/css/main.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Extended" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro%7CRoboto:500,400italic,300,400" rel="stylesheet">
  
  <link rel="canonical" href="http://localhost:4000/json/">

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-67589403-1', 'auto');
    ga('send', 'pageview');
  </script>

  <meta name="google-site-verification" content="HFqxhSbf9YA_0rBglNLzDiWnrHiK_w4cqDh2YD2GEY4" />
</head>


  <body class="">

    <div id="overlay-under-drawer"><!-- for the drawer on narrow screens --></div>

    <header class="site-header">
  <div class="container-fluid header-contents">
    <div class="row">
      <div class="col-md-12">
        <i class="fa fa-bars" id="sidebar-toggle-button" aria-hidden="true" style="display:none"></i>
        <img src="/images/flutter-mark-square-100.png" alt="Flutter Logo" width="40" height="40" style="vertical-align:middle">

        <a class="site-title" href="/">Flutter</a>

        <nav class="site-nav">
          <a href="#" class="menu-icon">
            <i class="material-icons-extended">more_vert</i>
          </a>
          <div class="trigger">
            <a class="page-link" href="/docs/">文档</a>
            <a class="page-link" href="/showcase/">案例</a>
            <a class="page-link" href="https://github.com/flutter/flutter">GitHub</a>
            <a class="page-link" href="https://pub.dartlang.org/flutter">库</a>
            <a class="page-link" href="/support/">支持</a>
            <a class="page-link" href="http://flutter-dev.cn">中文开发者论坛</a>
            <form action="/search/" class="nav-searchbox" id="cse-search-box" style="display: inline">
              <input type="hidden" name="cx" value="007067728241810524621:gm6vraqlc8c">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="hidden" name="hl" value="en">
              <input type="search" name="q" id="q" autocomplete="off" placeholder="搜索">
            </form>
          </div>
        </nav>
      </div>
    </div> <!-- /.row -->
  </div> <!-- /.container -->
</header>


    <!-- Page Content -->
    <div class="container-fluid contents">
      <!-- Content Row -->
      <div class="row">

        <!-- Sidebar Column -->
        <div id="side-nav-container" class="col-sm-3">
          <ul id="mysidebar" class="nav">

  <li class="sidebar-title">入门</li>

    <ul class="sidebar-items">
      <li><a href="/get-started/install/">1: 安装</a></li>
      <li><a href="/get-started/editor/">2: 配置编辑器</a></li>
      <li><a href="/get-started/test-drive/">3: Flutter 初体验</a></li>
      <li><a href="/get-started/codelab/">4: 编写第一个 Flutter 应用</a></li>
      <li><a href="/get-started/learn-more/">5: 学习更多</a></li>
    </ul>

  <li class="sidebar-title">构建 UI</li>

    <ul class="sidebar-items">
      <li><a href="/widgets-intro/">框架预览</a></li>
      <li><a href="/widgets/">Widget 目录</a></li>
      <li><a href="/cookbook/">小案例</a></li>
      <li><a href="/catalog/samples/">示例目录</a></li>
      <li><a href="/codelabs">Codelab</a></li>
      <li><a href="/tutorials/layout/">构建布局 - 教程</a></li>
      <li><a href="/tutorials/interactive/">添加交互 - 教程</a></li>
      <li><a href="/web-analogs/"> Web 开发者参考</a></li>
      <li><a href="/flutter-for-android/">Android 开发者参考</a></li>
      <li><a href="/flutter-for-ios/">iOS 开发者参考</a></li>
      <li><a href="/flutter-for-react-native/">React Native 开发者参考</a></li>
      <li><a href="/gestures/">手势</a></li>
      <li><a href="/animations/">动画</a></li>
      <li><a href="/layout/">框约束</a></li>
      <li><a href="/assets-and-images/">资源与图像</a></li>
      <li><a href="/tutorials/internationalization">国际化</a></li>
      <li><a href="/accessibility">无障碍</a></li>
    </ul>

  <li class="sidebar-title">使用设备与 SDK 中的 API</li>

    <ul class="sidebar-items">
      <li><a href="/using-packages/">使用扩展包</a></li>
      <li><a href="/developing-packages/">开发扩展包</a></li>
      <li><a href="/platform-channels/">平台特定代码</a></li>
      <li><a href="/json/">JSON 和序列化</a></li>
      
    </ul>

  <li class="sidebar-title">开发与工具</li>

    <ul class="sidebar-items">
      <li><a href="/using-ide/">Flutter IDE 的使用</a></li>
      <li><a href="/hot-reload/">热重载的使用</a></li>
      <li><a href="/testing/">应用测试</a></li>
      <li><a href="/debugging/">应用调试</a></li>
      <li><a href="/ui-performance/">性能分析</a></li>
      <li><a href="/inspector/">用户界面检查</a></li>
      <li><a href="/android-release/">编译正式版的 Android 应用</a></li>
      <li><a href="/ios-release/">编译正式版的 iOS 应用</a></li>
      <li><a href="/fastlane-cd/">使用 Fastlane 持续部署</a></li>
      <li><a href="/upgrading/">升级 Flutter</a></li>
      <li><a href="/formatting/"> 格式化代码</a></li>
    </ul>

  <li class="sidebar-title">更多细节</li>

    <ul class="sidebar-items">
      <li><a href="/faq/">FAQ</a></li>
      <li><a href="/technical-overview">技术一览</a></li>
      <li><a href="https://docs.google.com/presentation/d/1B3p0kP6NV_XMOimRV09Ms75ymIjU5gr6GGIX74Om_DE/edit?usp=sharing">神奇的 Flutter - 幻灯片</a></li>
      <li><a href="https://docs.google.com/presentation/d/1cw7A4HbvM_Abv320rVgPVGiUP2msVs7tfGbkgdrTy0I/edit?usp=sharing">架构图</a></li>
      <li><a href="https://www.bilibili.com/video/av14430321/">Flutter 框架层设计 <i class="fa fa-video-camera" aria-hidden="true"></i></a></li>
      <li><a href="https://www.bilibili.com/video/av6269773/">Flutter 的渲染管线 <i class="fa fa-video-camera" aria-hidden="true"></i></a></li>
    </ul>

</ul>

        </div>

        
        

        <!-- Content Column -->
        <div class="col-sm-9 main-contents">
          <div class="main-contents-body">
            <article class="post-content">
  
  
  <header class="post-header">
      <div class="btn-group contribute" role="group">
         <a href="https://github.com/flutter/website/blob/master/zh_CN/json.md" class="btn btn-sm">
            <i class="fa fa-pencil"></i> Edit Source
         </a>
         <a href="https://github.com/flutter/flutter/issues/new?title=Issue from website page JSON 和序列化&body=From URL: http://localhost:4000/json/&labels=dev: docs - website" class="btn btn-sm">
            <i class="fa fa-github"></i> File Issue
        </a>
     </div>
   <div>
    <h1 class="post-title">JSON 和序列化 </h1>
   </div>

  </header>
  

  <p>很难想象一个移动应用不需要和 web 服务器通信或者在某些时候很简单的存储结构化的数据。当开发基于网络的应用时，我们需要生成又老有好用的 JSON。</p>

<p>在这篇课程中，我们窥探一些在 Flutter 中使用 JSON的方法。我们检查一些在不同场景下使用 JSON 的方案以及为什么要这么做。</p>

<ul id="markdown-toc">
  <li><a href="#哪一种-json-的序列化方法适合我" id="markdown-toc-哪一种-json-的序列化方法适合我">哪一种 JSON 的序列化方法适合我？</a>    <ul>
      <li><a href="#小项目使用手动序列化" id="markdown-toc-小项目使用手动序列化">小项目使用手动序列化</a></li>
      <li><a href="#在中大型项目中使用代码生成" id="markdown-toc-在中大型项目中使用代码生成">在中大型项目中使用代码生成</a></li>
    </ul>
  </li>
  <li><a href="#在-flutter-中是否有等价与-gsonjacksonmoshi-的库" id="markdown-toc-在-flutter-中是否有等价与-gsonjacksonmoshi-的库">在 Flutter 中是否有等价与 GSON/Jackson/Moshi 的库?</a></li>
  <li><a href="#使用-dartconvert-手动序列化-json" id="markdown-toc-使用-dartconvert-手动序列化-json">使用 dart:convert 手动序列化 JSON</a>    <ul>
      <li><a href="#内联序列化-json" id="markdown-toc-内联序列化-json">内联序列化 JSON</a></li>
      <li><a href="#在模型类内部序列化-json" id="markdown-toc-在模型类内部序列化-json">在模型类内部序列化 JSON</a></li>
    </ul>
  </li>
  <li><a href="#使用-json-序列化代码生成库" id="markdown-toc-使用-json-序列化代码生成库">使用 JSON 序列化代码生成库</a>    <ul>
      <li><a href="#在项目中设置-json_serializable" id="markdown-toc-在项目中设置-json_serializable">在项目中设置 json_serializable</a></li>
      <li><a href="#创建模型类的-json_serializable-方式" id="markdown-toc-创建模型类的-json_serializable-方式">创建模型类的 json_serializable 方式</a></li>
      <li><a href="#运行代码生成工具" id="markdown-toc-运行代码生成工具">运行代码生成工具</a>        <ul>
          <li><a href="#一次性生成代码" id="markdown-toc-一次性生成代码">一次性生成代码</a></li>
          <li><a href="#持续地生成代码" id="markdown-toc-持续地生成代码">持续地生成代码</a></li>
        </ul>
      </li>
      <li><a href="#使用-json_serializable-模型类" id="markdown-toc-使用-json_serializable-模型类">使用 json_serializable 模型类</a></li>
    </ul>
  </li>
  <li><a href="#更多相关文档" id="markdown-toc-更多相关文档">更多相关文档</a></li>
</ul>

<h2 id="哪一种-json-的序列化方法适合我">哪一种 JSON 的序列化方法适合我？</h2>

<p>本文介绍了两种通用的使用 JSON 的策略：</p>

<ul>
  <li>手动序列化和反序列化</li>
  <li>通过代码生成自动序列化和反序列化</li>
</ul>

<p>不同的项目伴随着不同的复杂度和使用场景。对于比较小的验证性项目或者快速原型，使用代码生成可能更有效果。对于有更多 JSON 模型和更复杂的应用，手动序列化很快就变得乏味无趣，重复性劳动并且会产生很多小错误。</p>

<h3 id="小项目使用手动序列化">小项目使用手动序列化</h3>

<p>手动序列化是指使用在 <code class="highlighter-rouge">dart:convert</code> 中的内置解码器。包括传入 JSON 原始字符串给 <code class="highlighter-rouge">JSON.decode()</code> 方法，然后从 <code class="highlighter-rouge">Map&lt;String, dynamic&gt;</code> 中查询你需要的数据。它没有外部依赖或特定的设置过程，有助于目的的快速验证。</p>

<p>当你的项目变得越来越大时，手动序列化变得不那么好用。手动编写序列化逻辑会变得更难管理并且容易出错。如果你编写了错误的代码而访问了一个不存在的 JSON 字段，代码会在运行时抛出错误。</p>

<p>如果在你项目中的 JSON 模型不是很多并且期望快速验证目的，手动序列化会是你想要开始使用的方法。关于手动序列化的例子，<a href="#manual-serialization">参阅这里</a>.</p>

<h3 id="在中大型项目中使用代码生成">在中大型项目中使用代码生成</h3>

<p>使用代码生成来序列化 JSON 意味着需要额外的库来为你生成序列化样板文件。包括一些初始化设置和运行一个文件监控器来为你的模型类生成代码。例如，<a href="https://pub.dartlang.org/packages/json_serializable">json_serializable</a> 和
<a href="https://pub.dartlang.org/packages/built_value">built_value</a> 就是这一类的库。</p>

<p>这个方法很好的适应大型项目。不需要手写样板文件，并且访问 JSON 字段的编码错误会在编译时被捕获。负面影响就是代码生成包含了一些初始化的设置。而且，生成的源码文件也许在项目导航器中生成杂乱的可见的。</p>

<p>当你拥有一个中大型项目时，也许你想对 JSON 序列化使用代码生成。参考基于代码生成的 JSON 序列化的列子，<a href="#code-generation">参阅这里</a>.</p>

<h2 id="在-flutter-中是否有等价与-gsonjacksonmoshi-的库">在 Flutter 中是否有等价与 GSON/Jackson/Moshi 的库?</h2>

<p>答案是没有。</p>

<p>这些库需要用到运行时的反射机制，而这在 Flutter 中是被禁用的。运行时反射干涉了 <em>tree shaking</em>，这个特性 Dart 已经支持很久了。通过 tree shaking，我们可以在发布版本中“摆脱”一些无用的代码。这对于我们优化应用的大小有了重大意义。</p>

<p>自从反射默认隐式调用所有代码，这让 tree
shaking 变得困难。工具无法知道哪些部分在运行时未使用，以至于多余的代码很难被清理掉。在使用反射时应用大小不容易被优化。</p>

<aside class="alert alert-info">
  <p><strong>dartson 怎么样?</strong></p>

  <p><a href="https://pub.dartlang.org/packages/dartson">dartson</a> 使用了运行时反射，对于 Flutter 来说不适用。</p>
</aside>

<p>虽然我们不能在 Flutter 中使用运行时反射，取而代之，一些库给我们提供了类似的基于代码生成的简单接口。关于这个方法更多的细节在 <a href="#code-generation">code generation
libraries</a>。</p>

<p><a name="manual-serialization"></a></p>
<h2 id="使用-dartconvert-手动序列化-json">使用 dart:convert 手动序列化 JSON</h2>

<p>在 Flutter 中基本的 JSON 序列化非常简单。Flutter 拥有内置的<code class="highlighter-rouge">dart:convert</code> 库，包含了直白的 JSON 编码器和解码器。</p>

<p>这是一个用户模型的 JSON 例子。</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John Smith"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"john@example.com"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>通过 <code class="highlighter-rouge">dart:convert</code>，我们可以使用两种方法序列化这个 JSON 模型。让我们看一下。</p>

<h3 id="内联序列化-json">内联序列化 JSON</h3>

<p>从文档 <a href="https://api.dartlang.org/stable/1.24.3/dart-convert/JsonCodec-class.html">the dart:convert JSON
documentation</a>
可以看出，我们可以把 JSON 字符串作为参数，通过调用方法 <code class="highlighter-rouge">JSON.decode</code> 可以解码 JSON。</p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">,</span> <span class="kd">dynamic</span><span class="o">&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="n">JSON</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>

<span class="n">print</span><span class="o">(</span><span class="s">'Howdy, </span><span class="si">${user['name']}</span><span class="s">!'</span><span class="o">);</span>
<span class="n">print</span><span class="o">(</span><span class="s">'We sent the verification link to </span><span class="si">${user['email']}</span><span class="s">.'</span><span class="o">);</span>
</code></pre>
</div>

<p>不幸的是，<code class="highlighter-rouge">JSON.decode()</code> 仅仅返回一个 <code class="highlighter-rouge">Map&lt;String, dynamic&gt;</code>，意味着我们直到运行时才能知道值的类型。使用这个方法，我们丢失了很多静态类型语言的特性：类型安全，自动补齐和最重要的，编译时异常。我们的代码会马上变得容易出错。</p>

<p>例如，任何当我们访问 <code class="highlighter-rouge">name</code> 或者 <code class="highlighter-rouge">email</code> 字段的时候，我们都可能会引入一个编码错误。而这个编码错误是编译器所不知道的，因为整个 JSON 仅仅存在于一个字典的结构里面。</p>

<h3 id="在模型类内部序列化-json">在模型类内部序列化 JSON</h3>

<p>通过引入一个叫做 <code class="highlighter-rouge">User</code> 的普通的模型类，我们实际运用一下我们之前提到的问题，我们拥有：</p>

<ul>
  <li>一个 <code class="highlighter-rouge">User.fromJson</code> 构造器，用于从一个字典 数据结构构造一个新的 <code class="highlighter-rouge">User</code> 实例。</li>
  <li>一个 <code class="highlighter-rouge">toJson</code> 方法，用于将 <code class="highlighter-rouge">User</code> 的实例转化成一个字典。</li>
</ul>

<p>这样，<em>调用代码</em> 可以提供类型安全，为 <code class="highlighter-rouge">name</code> and <code class="highlighter-rouge">email</code> 字段自动补全和编译时异常。 如果我们编码错误或者把 <code class="highlighter-rouge">String</code> 当成 <code class="highlighter-rouge">int</code> 来处理，我们的应用程序将不会编译，而不是在运行时崩溃。</p>

<p><strong>user.dart</strong></p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kt">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">final</span> <span class="kt">String</span> <span class="n">email</span><span class="o">;</span>

  <span class="n">User</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">email</span><span class="o">);</span>

  <span class="n">User</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">,</span> <span class="kd">dynamic</span><span class="o">&gt;</span> <span class="n">json</span><span class="o">)</span>
      <span class="o">:</span> <span class="n">name</span> <span class="o">=</span> <span class="n">json</span><span class="o">[</span><span class="s">'name'</span><span class="o">],</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">json</span><span class="o">[</span><span class="s">'email'</span><span class="o">];</span>

  <span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">,</span> <span class="kd">dynamic</span><span class="o">&gt;</span> <span class="n">toJson</span><span class="o">()</span> <span class="o">=&gt;</span>
    <span class="o">{</span>
      <span class="s">'name'</span><span class="o">:</span> <span class="n">name</span><span class="o">,</span>
      <span class="s">'email'</span><span class="o">:</span> <span class="n">email</span><span class="o">,</span>
    <span class="o">};</span>
<span class="o">}</span>
</code></pre>
</div>

<p>现在序列化的逻辑被移到了 model 里面，通过这个方法，我们能非常简单地反序列化 user。</p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="n">Map</span> <span class="n">userMap</span> <span class="o">=</span> <span class="n">JSON</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
<span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">userMap</span><span class="o">);</span>

<span class="n">print</span><span class="o">(</span><span class="s">'Howdy, </span><span class="si">${user.name}</span><span class="s">!'</span><span class="o">);</span>
<span class="n">print</span><span class="o">(</span><span class="s">'We sent the verification link to </span><span class="si">${user.email}</span><span class="s">.'</span><span class="o">);</span>
</code></pre>
</div>

<p>要序列化 user，我们只需要将 <code class="highlighter-rouge">User</code> 对象传入 <code class="highlighter-rouge">JSON.encode</code> 方法。在这儿我们不需要调用 <code class="highlighter-rouge">toJson</code> 方法，因为 <code class="highlighter-rouge">JSON.encode</code> 已经为我们做了。</p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="kt">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">JSON</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
</code></pre>
</div>

<p>这样，调用代码就不用担心JSON序列化了。然而，模型类仍然需要。在应用的生产应用中，我们希望确保序列化工作正常。在实际应用中，<code class="highlighter-rouge">User.fromJson</code> 和 <code class="highlighter-rouge">User.toJson</code> 方法都需要适当的单元测试来验证正确的行为。</p>

<p>而且，现实世界的场景通常不是那么简单。我们不大可能获取如此小的 JSON 响应对象。嵌套的 JSON 对象很常见。</p>

<p>如果有什么东西可以为我们处理好 JSON 序列化就太好了。幸运的是，确实有！</p>

<p><a name="code-generation"></a></p>
<h2 id="使用-json-序列化代码生成库">使用 JSON 序列化代码生成库</h2>

<p>虽然还有一些其他的库可用，但是在本教程中，我们使用 <a href="https://pub.dartlang.org/packages/json_serializable">json_serializable package</a>。这是一个自动化的源代码生成器，可以生成 JSON 序列化样板。</p>

<p>由于序列化代码不再由我们手写和维护，所以我们尽量减少了 JSON 序列化在运行时发生异常的风险。</p>

<h3 id="在项目中设置-json_serializable">在项目中设置 json_serializable</h3>

<p>想要在我们的项目包含 <code class="highlighter-rouge">json_serializable</code> ，需要一个 regular 和两个 <em>dev
依赖</em> 。简言之， <em>dev 依赖</em> 就是那些不包含在应用源代码中的的依赖项。</p>

<p>通过<a href="https://github.com/dart-lang/json_serializable/blob/master/example/pubspec.yaml">链接</a>可以看到这些依赖项的最新版本。</p>

<p><strong>pubspec.yaml</strong></p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">dependencies</span><span class="pi">:</span>
  <span class="c1"># Your other regular dependencies here</span>
  <span class="s">json_annotation</span><span class="pi">:</span> <span class="s">^0.2.2</span>

<span class="s">dev_dependencies</span><span class="pi">:</span>
  <span class="c1"># Your other dev_dependencies here</span>
  <span class="s">build_runner</span><span class="pi">:</span> <span class="s">^0.7.6</span>
  <span class="s">json_serializable</span><span class="pi">:</span> <span class="s">^0.3.2</span>
</code></pre>
</div>

<p>在项目的根目录运行 <code class="highlighter-rouge">flutter packages get</code> (或者在编辑器中点击 “Packages
Get”) 可以使这些依赖作用于你的项目。</p>

<h3 id="创建模型类的-json_serializable-方式">创建模型类的 json_serializable 方式</h3>

<p>让我们看下如何将我们的 <code class="highlighter-rouge">User</code> 类转化成一个 <code class="highlighter-rouge">json_serializable</code>。为了简单起见，我们使用了之前的样例中的 JSON 模型。</p>

<p><strong>user.dart</strong></p>

<!-- skip -->
<pre class="prettyprint highlighter-rouge highlight lang-dart language-dart"><code>import &#39;package:json_annotation/json_annotation.dart&#39;;

/// This allows our `User` class to access private members in 
/// the generated file. The value for this is *.g.dart, where 
/// the star denotes the source file name.
part &#39;<span class="nocode highlight">user</span>.g.dart&#39;;

/// An annotation for the code generator to know that this class needs the 
/// JSON serialization logic to be generated.
<span class="nocode highlight">@JsonSerializable()</span>

/// Every json_serializable class must have the serializer mixin. 
/// It makes the generated toJson() method to be usable for the class. 
/// The mixin&#39;s name follows the source class, in this case, User.
class User extends Object with _$<span class="nocode highlight">User</span>SerializerMixin {
  User(this.name, this.email);

  String name;
  String email;

  /// A necessary factory constructor for creating a new User instance
  /// from a map. We pass the map to the generated _$UserFromJson constructor. 
  /// The constructor is named after the source class, in this case User.
  factory User.fromJson(Map&lt;String, dynamic&gt; json) =&gt; _$<span class="nocode highlight">User</span>FromJson(json);
}</code></pre>

<p>有了这个设置，源代码生成器将从 JSON 中的 <code class="highlighter-rouge">name</code> 和 <code class="highlighter-rouge">email</code> 字段生成代码。</p>

<p>如果需要，也可以很方便的自定义命名策略。例如，如果我们接口返回的对象是  <em>snake_case</em> 命名方式，而我们想在模型中使用 <em>lowerCamelCase</em> 命名，我们可以使用 <code class="highlighter-rouge">@JsonKey</code> 标注参数名:</p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="c1">/// Tell json_serializable that "registration_date_millis" should be</span>
<span class="c1">/// mapped to this property.</span>
<span class="nd">@JsonKey</span><span class="o">(</span><span class="nl">name:</span> <span class="s">'registration_date_millis'</span><span class="o">)</span>
<span class="kd">final</span> <span class="kt">int</span> <span class="n">registrationDateMillis</span><span class="o">;</span>
</code></pre>
</div>

<h3 id="运行代码生成工具">运行代码生成工具</h3>

<p>当第一次创建 <code class="highlighter-rouge">json_serializable</code> 类的时候，你会收到与下面图片类似的错误。</p>

<p><img src="/images/json/ide_warning.png" alt="IDE warning when the generated code for a model class does not exist
yet." /></p>

<p>这些错误及其常见也很简单因为模型类的生成代码还不存在。要解决这个问题，我们必须运行代码生成器来为我们生成序列化模板代码。</p>

<p>两种方法可以运行代码生成器。</p>

<h4 id="一次性生成代码">一次性生成代码</h4>

<p>在项目根目录运行 <code class="highlighter-rouge">flutter packages pub run build_runner build</code> ，我们就可以在任何需要的时候为我们的模型类生成 json 序列化代码。这个触发器一次性编译我们代码中相关的类并为他们生成必要的序列化代码。</p>

<p>虽然这非常方便，但如果我们每次在模型类中进行更改时都不需要手动地运行构建，那就更好了。</p>

<h4 id="持续地生成代码">持续地生成代码</h4>

<p><em>watcher</em>  可以让我们的代码生成过程更加方便。它会监控我们项目文件的改变并在需要的时候自动编译那些必要的文件。我们可以在项目根目录下运行 <code class="highlighter-rouge">flutter packages pub run build_runner watch</code> 来启动 watcher.</p>

<p>启动 watcher 并让它在后台安全的运行.</p>

<h3 id="使用-json_serializable-模型类">使用 json_serializable 模型类</h3>

<p>使用 <code class="highlighter-rouge">json_serializable</code> 的方法反序列化 JSON 字符串，我们不需要对之前的代码做任何改动。</p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="n">Map</span> <span class="n">userMap</span> <span class="o">=</span> <span class="n">JSON</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
<span class="kd">var</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">userMap</span><span class="o">);</span>
</code></pre>
</div>

<p>同样的对于序列化。和之前一样的调用 API。</p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="kt">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">JSON</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
</code></pre>
</div>

<p>使用 <code class="highlighter-rouge">json_serializable</code>，我们可以忘了在 <code class="highlighter-rouge">User</code> 类中任何手动调用 JSON 序列化的代码。代码生成器会创建一个叫做 <code class="highlighter-rouge">user.g.dart</code> 的文件，它包含了所有必要的序列化逻辑。现在我们不必编写自动化测试来确保序列化能工作 - 现在这是 <em>库的责任</em>。</p>

<h2 id="更多相关文档">更多相关文档</h2>

<ul>
  <li><a href="https://api.dartlang.org/stable/1.24.3/dart-convert/JsonCodec-class.html">JsonCodec documentation</a></li>
  <li><a href="https://pub.dartlang.org/packages/json_serializable">The json_serializable package in Pub</a></li>
  <li><a href="https://github.com/dart-lang/json_serializable/blob/master/example/lib/example.dart">json_serializable examples in GitHub</a></li>
  <li><a href="https://github.com/flutter/flutter/issues/1150">Discussion about dart:mirrors in Flutter</a></li>
</ul>

</article>

          </div>
        </div>

        

      </div> <!-- /.row -->
    </div> <!-- /.container -->

    <footer class="site-footer">
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-12">
        <div class="logo">
          <img src="/images/flutter-mark-square-100.png" alt="Flutter Logo" width="100" height="100">
        </div>
        <p class="site-footer__link-list">
          <a href="https://groups.google.com/forum/#!forum/flutter-dev">flutter-dev@</a> &bull;
          <a href="https://twitter.com/flutterio">twitter</a> &bull;
          <a href="https://github.com/flutter/">github</a> &bull;
          <a href="/tos">terms</a> &bull;
          <a href="https://www.google.com/intl/en/policies/privacy/">privacy</a> &bull;
          <a href="https://github.com/orgs/flutter-dev/teams/flutter/">翻译组</a>
        </p>

        <p class="licenses">
          除非另有说明，否则本作品根据
          <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0 国际许可证</a>进行许可，代码示例已根据 BSD 许可证进行许可。
        </p>
      </div>
    </div>
  </div>
</footer>

    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="/js/sidebar_toggle.js"></script>
    <script src="/js/customscripts.js"></script>
    <script src="/js/prism.js"></script>
    <script src="/js/tabs.js"></script>
    <script src="/js/archive.js"></script>
    
    <script async="" defer="" src="//survey.g.doubleclick.net/async_survey?site=at3ul57xpub2vk3oxt2ytw365i"></script>
  </body>
</html>
