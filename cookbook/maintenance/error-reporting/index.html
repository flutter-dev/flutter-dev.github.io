<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Report errors to a service  - Flutter </title>
  <link rel="shortcut icon" href="/images/favicon.png">

  <meta name="description" content="">
  <meta name="keywords" content=" ">

  <link rel="stylesheet" href="/css/lavish-bootstrap.css">
  <link rel="stylesheet" href="/css/main.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Extended" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro%7CRoboto:500,400italic,300,400" rel="stylesheet">
  
  <link rel="canonical" href="http://localhost:4000/cookbook/maintenance/error-reporting/">

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-67589403-1', 'auto');
    ga('send', 'pageview');
  </script>

  <meta name="google-site-verification" content="HFqxhSbf9YA_0rBglNLzDiWnrHiK_w4cqDh2YD2GEY4" />
</head>


  <body class="">

    <div id="overlay-under-drawer"><!-- for the drawer on narrow screens --></div>

    <header class="site-header">
  <div class="container-fluid header-contents">
    <div class="row">
      <div class="col-md-12">
        <i class="fa fa-bars" id="sidebar-toggle-button" aria-hidden="true" style="display:none"></i>
        <img src="/images/flutter-mark-square-100.png" alt="Flutter Logo" width="40" height="40" style="vertical-align:middle">

        <a class="site-title" href="/">Flutter</a>

        <nav class="site-nav">
          <a href="#" class="menu-icon">
            <i class="material-icons-extended">more_vert</i>
          </a>
          <div class="trigger">
            <a class="page-link" href="/docs/">文档</a>
            <a class="page-link" href="https://github.com/flutter/flutter">GitHub</a>
            <a class="page-link" href="https://pub.dartlang.org/flutter">库</a>
            <a class="page-link" href="/support/">支持</a>
            <a class="page-link" href="http://flutter-dev.cn">论坛</a>
            <form action="/search/" class="nav-searchbox" id="cse-search-box" style="display: inline">
              <input type="hidden" name="cx" value="007067728241810524621:gm6vraqlc8c">
              <input type="hidden" name="ie" value="UTF-8">
              <input type="hidden" name="hl" value="en">
              <input type="search" name="q" id="q" autocomplete="off" placeholder="搜索">
            </form>
          </div>
        </nav>
      </div>
    </div> <!-- /.row -->
  </div> <!-- /.container -->
</header>


    <!-- Page Content -->
    <div class="container-fluid contents">
      <!-- Content Row -->
      <div class="row">

        <!-- Sidebar Column -->
        <div id="side-nav-container" class="col-sm-3">
          <ul id="mysidebar" class="nav">

  <li class="sidebar-title">入门</li>

    <ul class="sidebar-items">
      <li><a href="/get-started/install/">1: 安装</a></li>
      <li><a href="/get-started/editor/">2: 配置编辑器</a></li>
      <li><a href="/get-started/test-drive/">3: Flutter 初体验</a></li>
      <li><a href="/get-started/codelab/">4: 编写第一个 Flutter 应用</a></li>
      <li><a href="/get-started/learn-more/">5: 学习更多</a></li>
    </ul>

  <li class="sidebar-title">构建 UI</li>

    <ul class="sidebar-items">
      <li><a href="/widgets-intro/">框架预览</a></li>
      <li><a href="/widgets/">Widget 目录</a></li>
      <li><a href="/cookbook/">小案例</a></li>
      <li><a href="/catalog/samples/">示例目录</a></li>
      <li><a href="/codelabs">Codelab</a></li>
      <li><a href="/tutorials/layout/">构建布局 - 教程</a></li>
      <li><a href="/tutorials/interactive/">添加交互 - 教程</a></li>
      <li><a href="/web-analogs/"> Web 开发者参考</a></li>
      <li><a href="/flutter-for-android/">Android 开发者参考</a></li>
      <li><a href="/flutter-for-ios/">iOS 开发者参考</a></li>
      <li><a href="/flutter-for-react-native/">React Native 开发者参考</a></li>
      <li><a href="/gestures/">手势</a></li>
      <li><a href="/animations/">动画</a></li>
      <li><a href="/layout/">框约束</a></li>
      <li><a href="/assets-and-images/">资源与图像</a></li>
      <li><a href="/tutorials/internationalization">国际化</a></li>
      <li><a href="/accessibility">无障碍</a></li>
    </ul>

  <li class="sidebar-title">使用设备与 SDK 中的 API</li>

    <ul class="sidebar-items">
      <li><a href="/using-packages/">使用扩展包</a></li>
      <li><a href="/developing-packages/">开发扩展包</a></li>
      <li><a href="/platform-channels/">平台特定代码</a></li>
      <li><a href="/json/">JSON 和序列化</a></li>
      
    </ul>

  <li class="sidebar-title">开发与工具</li>

    <ul class="sidebar-items">
      <li><a href="/using-ide/">Flutter IDE 的使用</a></li>
      <li><a href="/hot-reload/">热重载的使用</a></li>
      <li><a href="/testing/">应用测试</a></li>
      <li><a href="/debugging/">应用调试</a></li>
      <li><a href="/ui-performance/">性能分析</a></li>
      <li><a href="/inspector/">用户界面检查</a></li>
      <li><a href="/android-release/">编译正式版的 Android 应用</a></li>
      <li><a href="/ios-release/">编译正式版的 iOS 应用</a></li>
      <li><a href="/fastlane-cd/">使用 Fastlane 持续部署</a></li>
      <li><a href="/upgrading/">升级 Flutter</a></li>
      <li><a href="/formatting/"> 格式化代码</a></li>
    </ul>

  <li class="sidebar-title">更多细节</li>

    <ul class="sidebar-items">
      <li><a href="/faq/">FAQ</a></li>
      <li><a href="/technical-overview">技术一览</a></li>
      <li><a href="https://docs.google.com/presentation/d/1B3p0kP6NV_XMOimRV09Ms75ymIjU5gr6GGIX74Om_DE/edit?usp=sharing">神奇的 Flutter - 幻灯片</a></li>
      <li><a href="https://docs.google.com/presentation/d/1cw7A4HbvM_Abv320rVgPVGiUP2msVs7tfGbkgdrTy0I/edit?usp=sharing">架构图</a></li>
      <li><a href="https://www.bilibili.com/video/av14430321/">Flutter 框架层设计 <i class="fa fa-video-camera" aria-hidden="true"></i></a></li>
      <li><a href="https://www.bilibili.com/video/av6269773/">Flutter 的渲染管线 <i class="fa fa-video-camera" aria-hidden="true"></i></a></li>
    </ul>

</ul>

        </div>

        
        

        <!-- Content Column -->
        <div class="col-sm-9 main-contents">
          <div class="main-contents-body">
            <article class="post-content">
  
  
  <header class="post-header">
      <div class="btn-group contribute" role="group">
         <a href="https://github.com/flutter/website/blob/master/cookbook/maintenance/error-reporting.md" class="btn btn-sm">
            <i class="fa fa-pencil"></i> Edit Source
         </a>
         <a href="https://github.com/flutter/flutter/issues/new?title=Issue from website page Report errors to a service&body=From URL: http://localhost:4000/cookbook/maintenance/error-reporting/&labels=dev: docs - website" class="btn btn-sm">
            <i class="fa fa-github"></i> File Issue
        </a>
     </div>
   <div>
    <h1 class="post-title">Report errors to a service </h1>
   </div>

  </header>
  

  <p>While we always do our best to create apps that are free of bugs, they’re sure 
to crop up from time to time. Since buggy apps lead to unhappy 
users and customers, it’s important to understand how often our users experience
bugs and where those bugs occur. That way, we can prioritize the bugs with the
highest impact and work to fix them.</p>

<p>How can we determine how often our users experiences bugs? Whenever an error
occurs, we can create a report containing the error that occurred and the
associated stacktrace. We can then send the report to an error tracking service,
such as Sentry, Fabric, or Rollbar.</p>

<p>The error tracking service will then aggregate all of the crashes our users 
experience and group them together for us. This allows us to know how often our
app fails and where our users run into trouble.</p>

<p>In this recipe, we’ll see how to report errors to the 
<a href="https://sentry.io/welcome/">Sentry</a> crash reporting service.</p>

<h2 id="directions">Directions</h2>

<ol>
  <li>Get a DSN from Sentry</li>
  <li>Import the Sentry package</li>
  <li>Create a <code class="highlighter-rouge">SentryClient</code></li>
  <li>Create a function to report errors</li>
  <li>Catch and report Dart errors</li>
  <li>Catch and report Flutter errors</li>
</ol>

<h2 id="1-get-a-dsn-from-sentry">1. Get a DSN from Sentry</h2>

<p>Before we can report errors to Sentry, we’ll need a “DSN” to uniquely identify 
our app with the Sentry.io service.</p>

<p>To get a DSN, please:</p>

<ol>
  <li><a href="https://sentry.io/signup/">Create an account with Sentry</a></li>
  <li>Log in to the account</li>
  <li>Create a new app</li>
  <li>Copy the DSN</li>
</ol>

<h2 id="2-import-the-sentry-package">2. Import the Sentry package</h2>

<p>Next, we’ll need to import the 
<a href="https://pub.dartlang.org/packages/sentry"><code class="highlighter-rouge">sentry</code></a> package into our app. The 
sentry package will make it easier for us to send error reports to the Sentry
error tracking service.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">dependencies</span><span class="pi">:</span>
  <span class="s">sentry</span><span class="pi">:</span> <span class="s">&lt;latest_version&gt;</span>
</code></pre>
</div>

<h2 id="3-create-a-sentryclient">3. Create a <code class="highlighter-rouge">SentryClient</code></h2>

<p>We can now create a <code class="highlighter-rouge">SentryClient</code>. We will use the <code class="highlighter-rouge">SentryClient</code> to send 
error reports to the sentry service!</p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="kd">final</span> <span class="n">SentryClient</span> <span class="n">_sentry</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SentryClient</span><span class="o">(</span><span class="nl">dsn:</span> <span class="s">"App DSN goes Here"</span><span class="o">);</span>
</code></pre>
</div>

<h2 id="4-create-a-function-to-report-errors">4. Create a function to report errors</h2>

<p>With Sentry all set up, we can begin to report errors! Since we don’t want to 
report errors to Sentry during development, we’ll first create a function that 
let’s us know whether we’re in debug or production mode.</p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="kt">bool</span> <span class="kd">get</span> <span class="n">isInDebugMode</span> <span class="o">{</span>
  <span class="c1">// Assume we're in production mode</span>
  <span class="kt">bool</span> <span class="n">inDebugMode</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
  
  <span class="c1">// Assert expressions are only evaluated during development. They are ignored</span>
  <span class="c1">// in production. Therefore, this code will only turn `inDebugMode` to true</span>
  <span class="c1">// in our development environments!</span>
  <span class="k">assert</span><span class="o">(</span><span class="n">inDebugMode</span> <span class="o">=</span> <span class="kc">true</span><span class="o">);</span>
  
  <span class="k">return</span> <span class="n">inDebugMode</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Next, we can use this function in combination with the <code class="highlighter-rouge">SentryClient</code> to report 
errors when our app is in production mode.</p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="n">Future</span><span class="o">&lt;</span><span class="n">Null</span><span class="o">&gt;</span> <span class="n">_reportError</span><span class="o">(</span><span class="kd">dynamic</span> <span class="n">error</span><span class="o">,</span> <span class="kd">dynamic</span> <span class="n">stackTrace</span><span class="o">)</span> <span class="n">async</span> <span class="o">{</span>
  <span class="c1">// Print the exception to the console </span>
  <span class="n">print</span><span class="o">(</span><span class="s">'Caught error: </span><span class="si">$error</span><span class="s">'</span><span class="o">);</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">isInDebugMode</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Print the full stacktrace in debug mode</span>
    <span class="n">print</span><span class="o">(</span><span class="n">stackTrace</span><span class="o">);</span>
    <span class="k">return</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="c1">// Send the Exception and Stacktrace to Sentry in Production mode</span>
    <span class="n">_sentry</span><span class="o">.</span><span class="na">captureException</span><span class="o">(</span>
      <span class="nl">exception:</span> <span class="n">error</span><span class="o">,</span>
      <span class="nl">stackTrace:</span> <span class="n">stackTrace</span><span class="o">,</span>
    <span class="o">);</span> 
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="5-catch-and-report-dart-errors">5. Catch and report Dart errors</h2>

<p>Now that we have a function to report errors depending on the environment, we
need a way to capture Dart errors so we can report them!</p>

<p>For this task, we will run our app inside a custom 
<a href="https://docs.flutter.io/flutter/dart-async/Zone-class.html"><code class="highlighter-rouge">Zone</code></a>. Zones 
establish an execution context for our code. This provides a convenient way to 
capture all errors that occur within that context by providing an <code class="highlighter-rouge">onError</code>.</p>

<p>In this case, we’ll run our app in a new <code class="highlighter-rouge">Zone</code> and capture all errors by 
providing an <code class="highlighter-rouge">onError</code> callback.</p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="n">runZoned</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">Null</span><span class="o">&gt;&gt;(()</span> <span class="n">async</span> <span class="o">{</span>
  <span class="n">runApp</span><span class="o">(</span><span class="k">new</span> <span class="n">CrashyApp</span><span class="o">());</span>
<span class="o">},</span> <span class="nl">onError:</span> <span class="o">(</span><span class="n">error</span><span class="o">,</span> <span class="n">stackTrace</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Whenever an error occurs, call the `_reportError` function. This will send</span>
  <span class="c1">// Dart errors to our dev console or Sentry depending on the environment.</span>
  <span class="n">_reportError</span><span class="o">(</span><span class="n">error</span><span class="o">,</span> <span class="n">stackTrace</span><span class="o">);</span>
<span class="o">});</span>
</code></pre>
</div>

<h2 id="6-catch-and-report-flutter-errors">6. Catch and report Flutter errors</h2>

<p>In addition to Dart errors, Flutter can throw additional errors, such as 
platform exceptions that occur when calling native code. We need to be sure to 
capture and report these types of errors as well!</p>

<p>To capture Flutter errors, we can override the 
<a href="https://docs.flutter.io/flutter/foundation/FlutterError/onError.html"><code class="highlighter-rouge">FlutterError.onError</code></a>
property. In this case, if we’re in debug mode, we’ll use a convenience function
from Flutter to properly format the error. If we’re in production mode, we’ll 
send the error to our <code class="highlighter-rouge">onError</code> callback defined in the previous step.</p>

<!-- skip -->
<div class="language-dart highlighter-rouge"><pre class="highlight"><code><span class="c1">// This captures errors reported by the Flutter framework.</span>
<span class="n">FlutterError</span><span class="o">.</span><span class="na">onError</span> <span class="o">=</span> <span class="o">(</span><span class="n">FlutterErrorDetails</span> <span class="n">details</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">isInDebugMode</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// In development mode simply print to console.</span>
    <span class="n">FlutterError</span><span class="o">.</span><span class="na">dumpErrorToConsole</span><span class="o">(</span><span class="n">details</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="c1">// In production mode report to the application zone to report to</span>
    <span class="c1">// Sentry.</span>
    <span class="n">Zone</span><span class="o">.</span><span class="na">current</span><span class="o">.</span><span class="na">handleUncaughtError</span><span class="o">(</span><span class="n">details</span><span class="o">.</span><span class="na">exception</span><span class="o">,</span> <span class="n">details</span><span class="o">.</span><span class="na">stack</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">};</span>
</code></pre>
</div>

<h2 id="complete-example">Complete Example</h2>

<p>To view a working example, please view the 
<a href="https://github.com/flutter/crashy">Crashy</a> example app.</p>

</article>

          </div>
        </div>

        

      </div> <!-- /.row -->
    </div> <!-- /.container -->

    <footer class="site-footer">
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-12">
        <div class="logo">
          <img src="/images/flutter-mark-square-100.png" alt="Flutter Logo" width="100" height="100">
        </div>
        <p class="site-footer__link-list">
          <a href="https://groups.google.com/forum/#!forum/flutter-dev">flutter-dev@</a> &bull;
          <a href="https://twitter.com/flutterio">twitter</a> &bull;
          <a href="https://github.com/flutter/">github</a> &bull;
          <a href="/tos">terms</a> &bull;
          <a href="https://www.google.com/intl/en/policies/privacy/">privacy</a> &bull;
          <a href="https://github.com/orgs/flutter-dev/teams/flutter/">翻译组</a>
        </p>

        <p class="licenses">
          除非另有说明，否则本作品根据
          <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0 国际许可证</a>进行许可，代码示例已根据 BSD 许可证进行许可。
        </p>
      </div>
    </div>
  </div>
</footer>

    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="/js/sidebar_toggle.js"></script>
    <script src="/js/customscripts.js"></script>
    <script src="/js/prism.js"></script>
    <script src="/js/tabs.js"></script>
    <script src="/js/archive.js"></script>
    
    <script async="" defer="" src="//survey.g.doubleclick.net/async_survey?site=at3ul57xpub2vk3oxt2ytw365i"></script>
  </body>
</html>
